# Architecture Overview - Multi-City Flood System

## System Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND (React)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Dashboard (Main)                       â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ Live Pred   â”‚ â”‚ Forecast    â”‚ â”‚ Multi-City Scan  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   (Local)   â”‚ â”‚  (3 Days)   â”‚ â”‚  (NEW)           â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Simulation (Exists) â”‚   â”‚  Custom Prediction    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  (Now with Toggle)   â”‚   â”‚  (Unchanged)          â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           MultiCityScan Component (NEW)                  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Controls      â”‚  â”‚  Statistics Dashboard        â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - City Limit  â”‚  â”‚  - Total, Critical, High     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - Refresh Btn â”‚  â”‚  - Moderate, Low             â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚     FloodMap Component (Interactive Leaflet)     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                                    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Legend                                   â”‚   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ ğŸŸ¢ LOW  ğŸŸ¡ MOD  ğŸŸ  HIGH  ğŸ”´ CRIT       â”‚   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                                    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Map with Color-Coded Markers            â”‚   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ (onClick â†’ City Selection)               â”‚   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Cities List Grid (Scrollable)                   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  [City Card 1][City Card 2][City Card 3]...      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  Click "View Simulation" â†’ Opens Simulation      â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Simulation Section (When City Selected)         â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                                    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Mode Toggle        â”‚  Prediction â†” Sandbox   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                                    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Sliders (Sandbox)  â”‚  â”‚ Canvas Animation â”‚   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - Probability (%)  â”‚  â”‚ - Water Level    â”‚   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - Duration (hrs)   â”‚  â”‚ - Risk Color     â”‚   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                                    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Timeline (Hour-by-hour probabilities)     â”‚  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                                    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  Controls: Run | Play/Pause | Mute              â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              API Service Layer (api.js)                  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ Existing Endpoints                              â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ - getLivePrediction()                            â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ - get3DayForecast()                              â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ - runFloodSimulation()                           â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ - postPrediction()                               â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ - searchCities()                                 â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ - validateLocation()                             â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ New Endpoints (Multi-City)                       â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ - getMultiCitySample(limit)        (NEW)         â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ - getMultiCityPredictions(cities)  (NEW)         â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BACKEND (FastAPI)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Existing Endpoints (Unchanged)                  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  POST /predict          â†’ WeatherInput â†’ Prediction      â”‚  â”‚
â”‚  â”‚  GET  /predict/live     â†’ Location â†’ Prediction          â”‚  â”‚
â”‚  â”‚  GET  /forecast/3day    â†’ Location â†’ 3-Day Forecast      â”‚  â”‚
â”‚  â”‚  POST /simulate         â†’ Weather â†’ Timeline             â”‚  â”‚
â”‚  â”‚  GET  /cities           â†’ Query â†’ City Names             â”‚  â”‚
â”‚  â”‚  POST /validate-location â†’ Location â†’ Validation         â”‚  â”‚
â”‚  â”‚  GET  /explainability   â†’ Feature Importances            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         New Multi-City Endpoints                         â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  GET  /multi-city/sample              (NEW)              â”‚  â”‚
â”‚  â”‚  POST /multi-city/predictions         (NEW)              â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Handler Functions:                                       â”‚  â”‚
â”‚  â”‚  - get_sample_cities_endpoint()                          â”‚  â”‚
â”‚  â”‚  - get_cities_predictions()                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      Multi-City Utils (multi_city_utils.py) (NEW)        â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ Geocoding & Caching                            â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ - get_city_coordinates()                       â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ - Cache: {city_name: (lat, lon)}               â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ Weather Fetching                               â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ - fetch_live_weather_for_city()                â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ - Fallback default values                      â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ Prediction Pipeline                            â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ - get_flood_prediction_for_city()              â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ - get_multiple_cities_predictions()            â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ - Uses existing predict() from model_loader    â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ Sampling                                        â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ - get_sample_cities(limit)                     â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ - Reads from Cities.csv                        â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      Existing Core Modules (Unchanged)                  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  - model_loader.py     (ML Model & Predictions)          â”‚  â”‚
â”‚  â”‚  - simulation_engine.py (Hour-by-hour Timeline)          â”‚  â”‚
â”‚  â”‚  - city_loader.py       (City Database)                  â”‚  â”‚
â”‚  â”‚  - schemas.py           (Data Models)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ HTTP
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    External APIs                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Open-Meteo Weather API   â”‚  â”‚ Open-Meteo Geocoding APIâ”‚    â”‚
â”‚  â”‚ (Existing - Unchanged)   â”‚  â”‚ (Existing - Unchanged)  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Sources                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Cities.csv       â”‚  â”‚ ML Model         â”‚  â”‚ localStorage â”‚  â”‚
â”‚  â”‚ (Local File)     â”‚  â”‚ (Trained)        â”‚  â”‚ (Browser)    â”‚  â”‚
â”‚  â”‚ 5000+ cities     â”‚  â”‚ XGBoost          â”‚  â”‚ Caching      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

### Multi-City Scan Flow:

```
User Action: Click "Multi-City Scan" Tab
    â†“
MultiCityScan Component Loads
    â†“
    â”œâ”€â†’ GET /multi-city/sample?limit=15
    â”‚       â†“
    â”‚   Backend: get_sample_cities_endpoint()
    â”‚       â”œâ”€â†’ CSV: Get 15 city names
    â”‚       â†“
    â”‚   For each city:
    â”‚       â”œâ”€â†’ Geocode: get_city_coordinates(city_name)
    â”‚       â”‚   â”œâ”€â†’ Check cache first
    â”‚       â”‚   â”œâ”€â†’ If miss: Geocoding API
    â”‚       â”‚   â””â”€â†’ Cache result: {city: (lat, lon)}
    â”‚       â”‚
    â”‚       â”œâ”€â†’ Weather: fetch_live_weather_for_city(lat, lon)
    â”‚       â”‚   â””â”€â†’ Open-Meteo Current Weather API
    â”‚       â”‚
    â”‚       â”œâ”€â†’ Predict: predict(weather_features)
    â”‚       â”‚   â””â”€â†’ XGBoost Model â†’ Probability (0-1)
    â”‚       â”‚
    â”‚       â””â”€â†’ Classify: {LOW|MODERATE|HIGH|CRITICAL}
    â”‚
    â”‚   Return: List of cities with predictions
    â”‚       â†“
    â”œâ”€â†’ Render: FloodMap Component
    â”‚   â”œâ”€â†’ Load Leaflet from CDN
    â”‚   â”œâ”€â†’ Create markers for each city
    â”‚   â”œâ”€â†’ Color-code by risk level
    â”‚   â””â”€â†’ Add popups with city info
    â”‚
    â”œâ”€â†’ Render: Statistics Dashboard
    â”‚   â””â”€â†’ Count cities by risk level
    â”‚
    â””â”€â†’ Render: Cities List Grid
        â””â”€â†’ Summary cards for each city
```

### Simulation Flow (from Multi-City):

```
User Action: Click "View Simulation" for a City
    â†“
City data passed to Simulation Component
    â†“
Sandbox Mode Enabled
    â”œâ”€â†’ Probability set to: city.probability * 100
    â””â”€â†’ Duration: default 24 hours
    â†“
User Adjusts Sliders (Optional)
    â”œâ”€â†’ Probability: 0-100%
    â””â”€â†’ Duration: 1-168 hours
    â†“
User Clicks "Run Simulation"
    â†“
Generate Timeline (Client-side)
    â”œâ”€â†’ For each hour:
    â”‚   â”œâ”€â†’ Base probability: user input
    â”‚   â”œâ”€â†’ Add variation: sin wave + random noise
    â”‚   â”œâ”€â†’ Classify risk: getRiskFromProbability()
    â”‚   â””â”€â†’ Store: {hour, probability, risk_state}
    â†“
User Clicks "Play"
    â†“
Animation Loop (requestAnimationFrame)
    â”œâ”€â†’ Advance hour every 1.2 seconds
    â”œâ”€â†’ Update canvas: drawFrame(probability)
    â”‚   â””â”€â†’ Water height = probability * canvas_height
    â”œâ”€â†’ Update sound: startRain(probability)
    â”‚   â”œâ”€â†’ Frequency based on probability
    â”‚   â””â”€â†’ Gain based on probability
    â””â”€â†’ Warning sound if risk = CRITICAL
    â†“
Timeline Complete
    â””â”€â†’ Reset controls for next run
```

---

## State Management Flow

### Frontend State (React):

```
Dashboard (Top Level)
â”œâ”€â”€ location: { type, value }
â”œâ”€â”€ activeTab: "live" | "forecast" | "multi-city" | "simulation" | "custom"
â”œâ”€â”€ live: { location, probability, risk_level, ... }
â”œâ”€â”€ forecast: [{ day, probability, risk, ... }]
â””â”€â”€ customResult: { probability, risk_level }

MultiCityScan
â”œâ”€â”€ cities: [{ city, lat, lon, probability, risk_level, ... }]
â”œâ”€â”€ loading: boolean
â”œâ”€â”€ error: string | null
â”œâ”€â”€ selectedCity: { ... } | null
â”œâ”€â”€ showSimulation: boolean
â””â”€â”€ cityLimit: 5-50

Simulation
â”œâ”€â”€ timeline: [{ hour, probability, risk_state }]
â”œâ”€â”€ currentStep: 0-N
â”œâ”€â”€ playing: boolean
â”œâ”€â”€ useSimulationMode: boolean
â”œâ”€â”€ sandboxProbability: 0-100
â”œâ”€â”€ sandboxDuration: 1-168
â”œâ”€â”€ muted: boolean
â””â”€â”€ baseInput: { weather features }
```

---

## Component Hierarchy

```
App
â””â”€â”€ Dashboard
    â”œâ”€â”€ LocationSelector
    â”œâ”€â”€ Tabs
    â”‚   â”œâ”€â”€ Live Prediction
    â”‚   â”œâ”€â”€ 3-Day Forecast
    â”‚   â”‚   â””â”€â”€ ForecastChart
    â”‚   â”œâ”€â”€ Multi-City Scan (NEW)
    â”‚   â”‚   â”œâ”€â”€ MultiCityScan (NEW)
    â”‚   â”‚   â”‚   â”œâ”€â”€ FloodMap (NEW)
    â”‚   â”‚   â”‚   â”œâ”€â”€ Statistics Dashboard
    â”‚   â”‚   â”‚   â”œâ”€â”€ Cities List Grid
    â”‚   â”‚   â”‚   â””â”€â”€ [Simulation]
    â”‚   â”‚   â”‚       â””â”€â”€ Simulation (embedded)
    â”‚   â”œâ”€â”€ Simulation
    â”‚   â”‚   â””â”€â”€ Simulation Component
    â”‚   â””â”€â”€ Custom Prediction
    â””â”€â”€ Footer
```

---

## Database/File Structure

```
Project Root
â”œâ”€â”€ Cities.csv (5000+ rows)
â”‚   â””â”€â”€ Loaded into memory by city_loader.py
â”‚
â”œâ”€â”€ Backend
â”‚   â”œâ”€â”€ main.py (FastAPI app)
â”‚   â”œâ”€â”€ multi_city_utils.py (NEW)
â”‚   â”‚   â””â”€â”€ Caches: _coordinates_cache = {city: (lat, lon)}
â”‚   â”œâ”€â”€ city_loader.py (Unchanged)
â”‚   â”‚   â””â”€â”€ Caches: _cities_cache = [city_names]
â”‚   â”œâ”€â”€ model_loader.py (Unchanged)
â”‚   â”œâ”€â”€ simulation_engine.py (Unchanged)
â”‚   â”œâ”€â”€ schemas.py (Unchanged)
â”‚   â””â”€â”€ requirements.txt (Unchanged)
â”‚
â”œâ”€â”€ Frontend
â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ New deps: leaflet, react-leaflet
â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â””â”€â”€ Leaflet CSS from CDN
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â”œâ”€â”€ App.jsx (Unchanged)
â”‚   â”‚   â”œâ”€â”€ pages
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx (Updated)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Tab system updated
â”‚   â”‚   â”‚   â”œâ”€â”€ MultiCityScan.jsx (NEW)
â”‚   â”‚   â”‚   â”œâ”€â”€ Simulation.jsx (Updated)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Now accepts initialCity prop
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ components
â”‚   â”‚   â”‚   â”œâ”€â”€ FloodMap.jsx (NEW)
â”‚   â”‚   â”‚   â”œâ”€â”€ FloodMap.css (NEW)
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ services
â”‚   â”‚       â””â”€â”€ api.js (Updated)
â”‚   â”‚           â””â”€â”€ New functions: getMultiCity*
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ README.md (Existing instructions)
â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md (NEW - Detailed docs)
â””â”€â”€ QUICK_START.md (NEW - Quick reference)
```

---

## Error Handling Flow

```
API Call
    â†“
    â”œâ”€â†’ Network Error
    â”‚   â””â”€â†’ setError("Failed to...")
    â”‚       â””â”€â†’ Show error message to user
    â”‚
    â”œâ”€â†’ API Response Error (non-200)
    â”‚   â””â”€â†’ setError(error.detail || "Request failed")
    â”‚       â””â”€â†’ Show error message to user
    â”‚
    â”œâ”€â†’ JSON Parse Error
    â”‚   â””â”€â†’ Catch in try-catch
    â”‚       â””â”€â†’ Continue with fallback
    â”‚
    â””â”€â†’ Success (200)
        â”œâ”€â†’ setError(null)
        â”œâ”€â†’ Process data
        â””â”€â†’ Update UI
```

---

## Performance Optimizations

```
Request Deduplication
    â””â”€â†’ Geocoding results cached in memory
        â””â”€â†’ Prevents repeated API calls for same city

Lazy Loading
    â”œâ”€â†’ Leaflet library from CDN
    â””â”€â†’ Only loaded when map needed

Efficient Rendering
    â”œâ”€â†’ Canvas-based flood animation (not DOM)
    â”œâ”€â†’ requestAnimationFrame for smooth animation
    â””â”€â†’ React memoization for components

Request Limiting
    â””â”€â†’ Max 50 cities per multi-city request
        â””â”€â†’ Prevents server overload

Batch Processing
    â”œâ”€â†’ Process all cities in parallel loops
    â””â”€â†’ Cache results for reuse
```

---

**Architecture Version:** 2.0 (with Multi-City Extension)
**Last Updated:** January 16, 2026
